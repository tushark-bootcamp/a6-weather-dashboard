
/* Smart HTML Elements v6.0.0 (2020-Jan) 
Copyright (c) 2011-2020 jQWidgets. 
License: https://htmlelements.com/license/ */

Smart("smart-tree-item",class extends Smart.MenuItem{static get properties(){return{selected:{value:!1,type:"boolean"}}}ready(){Object.defineProperty(this,"hasStyleObserver",{get:function(){return!1}}),super.ready(),this.setAttribute("role","treeitem")}propertyChangedHandler(e,t,r){const l=this,o=l.menu;if("level"===e)return void(l.level=t);if("disabled"!==e&&"separator"!==e&&o){const a=o.context;switch(o.context=o,e){case"label":{const e=o.sorted&&o.autoSort;l.firstElementChild.firstElementChild.firstElementChild.innerHTML=r,e&&(o._unsortItems(o.$.mainContainer),o._applyGrouping(o.$.mainContainer)),o._state.filter&&o._applyFilter(o._state.filter);break}case"selected":l.selected=t,r?o.select(l):o.unselect(l);break;case"shortcut":{let e=l.firstElementChild.children[1];e||(e=document.createElement("div"),e.className="smart-tree-item-shortcut",l.firstElementChild.appendChild(e)),e.innerHTML=r;break}case"value":o.sort&&o.sorted&&o.autoSort&&o._refreshSorting();}o.context=a}}}),Smart("smart-tree-items-group",class extends Smart.MenuItemsGroup{static get properties(){return{selected:{value:!1,type:"boolean"}}}ready(){Object.defineProperty(this,"hasStyleObserver",{get:function(){return!1}}),super.ready();const e=this;e.setAttribute("role","treeitem"),e.removeAttribute("aria-haspopup")}propertyChangedHandler(e,t,r){const l=this,o=l.menu;if("level"===e)return void(l.level=t);if("disabled"!==e&&"separator"!==e&&o){const a=o.context;switch(o.context=o,e){case"expanded":{l.expanded=t,r?o.expandItem(l):o.collapseItem(l);break}case"label":{const e=o.sorted&&o.autoSort;l.firstElementChild.firstElementChild.firstElementChild.innerHTML=r,e&&(o._unsortItems(o.$.mainContainer),o._applyGrouping(o.$.mainContainer)),o._state.filter&&o._applyFilter(o._state.filter);break}case"selected":l.selected=t,r?o.select(l):o.unselect(l);break;case"value":o.sort&&o.sorted&&o.autoSort&&o._refreshSorting();}o.context=a}}}),Smart("smart-tree",class extends Smart.Menu{static get properties(){return{allowDrag:{value:!1,type:"boolean"},allowDrop:{value:!1,type:"boolean"},autoHideToggleElement:{value:!1,type:"boolean"},autoLoadState:{value:!1,type:"boolean"},autoSaveState:{value:!1,type:"boolean"},autoSort:{value:!0,type:"boolean"},displayLoadingIndicator:{value:!1,type:"boolean"},dragFeedbackFormatFunction:{value:null,type:"function?"},dragOffset:{value:[10,10],type:"array"},editable:{value:!1,type:"boolean"},filterable:{value:!1,type:"boolean"},filterInputPlaceholder:{value:"",type:"string"},filterMode:{value:"containsIgnoreCase",allowedValues:["contains","containsIgnoreCase","doesNotContain","doesNotContainIgnoreCase","equals","equalsIgnoreCase","startsWith","startsWithIgnoreCase","endsWith","endsWithIgnoreCase"],type:"string"},hasThreeStates:{value:!1,type:"boolean"},loadingIndicatorPlaceholder:{value:"Loading...",type:"string"},loadingIndicatorPosition:{value:"center",allowedValues:["bottom","center","top"],type:"string"},messages:{value:{en:{noId:"smart-tree: Saving and loading the element's state are not available if the element has no id."}},type:"object",extend:!0},scrollMode:{value:"scrollbar",allowedValues:["scrollbar","scrollButtons"],type:"string"},selectedIndexes:{value:[],type:"array"},selectionDisplayMode:{value:"row",allowedValues:["row","label"],type:"string"},selectionMode:{value:"one",allowedValues:["none","oneOrManyExtended","zeroOrMany","oneOrMany","zeroOrOne","one","checkBox","radioButton"],type:"string"},showLines:{value:!1,type:"boolean"},showRootLines:{value:!1,type:"boolean"},sort:{value:null,type:"function?"},sortDirection:{value:"asc",allowedValues:["asc","desc"],type:"string"},sorted:{value:!1,type:"boolean"},toggleElementPosition:{value:"near",allowedValues:["near","far"],type:"string"},toggleMode:{value:"dblclick",allowedValues:["click","dblclick","arrow"],type:"string"}}}static get listeners(){return{blur:"_blurHandler",focus:"_focusHandler",keydown:"_keydownHandler",mouseenter:"_mouseenterHandler",mouseleave:"_mouseleaveHandler",resize:"_checkOverflow",styleChanged:"_styleChangedHandler",transitionend:"_overriddenMenuHandler","container.click":"_overriddenMenuHandler","container.mouseout":"_overriddenMenuHandler","container.mouseover":"_overriddenMenuHandler","editInput.blur":"_editInputBlurHandler","filterInput.keydown":"_filterInputKeydownHandler","filterInput.keyup":"_filterInputKeyupHandler","mainContainer.click":"_overriddenMenuHandler","mainContainer.mouseleave":"_overriddenMenuHandler","mainContainer.mouseout":"_overriddenMenuHandler","mainContainer.mouseover":"_overriddenMenuHandler","mainContainer.swipeleft":"_mainContainerSwipeHandler","mainContainer.swiperight":"_mainContainerSwipeHandler","scrollButtonFar.click":"_scrollButtonFarClickHandler","scrollButtonNear.click":"_scrollButtonNearClickHandler","scrollViewer.down":"_scrollViewerDownHandler","scrollViewer.kineticScroll":"_scrollViewerWheelHandler","mainContainer.wheel":"_scrollViewerWheelHandler","document.move":"_moveHandler","document.up":"_documentUpHandler"}}static get requires(){return{"Smart.ScrollBar":"smart.scrollbar.js"}}static get styleUrls(){return["smart.scrollbar.css","smart.scrollviewer.css","smart.tree.css"]}template(){return`<div id="container" role="presentation">
                    <div class="smart-tree-filter-input-container" role="presentation">
                        <input id="filterInput" class="smart-filter-input" disabled="[[disabled]]" placeholder="[[filterInputPlaceholder]]" type="text" />
                    </div>
                    <smart-repeat-button id="scrollButtonNear" class="smart-tree-scroll-button smart-spin-button smart-scroll-button-near smart-hidden" animation="[[animation]]" unfocusable aria-label="Scroll up">
                        <div id="arrowNear" class="smart-arrow smart-arrow-up"></div>
                    </smart-repeat-button>
                    <smart-scroll-viewer id="scrollViewer" animation="[[animation]]" horizontal-scroll-bar-visibility="hidden" right-to-left="[[right-to-left]]">
                        <div id="mainContainer" class="smart-tree-main-container" role="presentation">
                            <content></content>
                        </div>
                        <input type="text" id="editInput" class="smart-tree-edit-input smart-hidden" />
                    </smart-scroll-viewer>
                    <smart-repeat-button id="scrollButtonFar" class="smart-tree-scroll-button smart-spin-button smart-scroll-button-far smart-hidden" animation="[[animation]]" unfocusable aria-label="Scroll down">
                        <div id="arrowFar" class="smart-arrow smart-arrow-down"></div>
                    </smart-repeat-button>
                    <div id="loadingIndicatorContainer" class="smart-loader-container smart-hidden">
                        <span id="loadingIndicator" class="smart-loader"></span>
                        <span id="loadingIndicatorPlaceHolder" class="smart-loader-label smart-hidden">[[loadingIndicatorPlaceholder]]</span>
                    </div>
                </div>`}addAfter(e,t){const r=this;t=r.getItem(t);void 0===t||r.addTo(e,t.parentItem,t,!0)}addBefore(e,t){const r=this;t=r.getItem(t);void 0===t||r.addTo(e,t.parentItem,t)}addTo(e,t){const r=this;if(!(e instanceof Smart.TreeItem||e instanceof Smart.TreeItemsGroup))return;let l,o;if(void 0===t)t=r.$.mainContainer,l=1,o=t;else{if(t=r.getItem(t),!1==t instanceof Smart.TreeItemsGroup)return;l=t.level+1,o=t.itemContainer}r._createItemHTMLStructure(e,l,t,o.childElementCount,0);const a=r.sorted&&r.autoSort,n=r._state.filter,i=r.selectedIndexes.slice(0);a&&r._unsortItems(r.$.mainContainer),e instanceof Smart.TreeItemsGroup&&r._processHTML(e,l+1,!1);let s=arguments[2];s&&arguments[3]&&(s=s.nextElementSibling),s?(o.insertBefore(e,s),r._menuItems={},r._refreshItemPaths(r.$.mainContainer,!0,void 0,r.sorted&&!r.autoSort)):o.appendChild(e),a&&r._applyGrouping(r.$.mainContainer),n&&r._applyFilter(n),r._checkOverflow(),r._expandItemsByDefault(),r.selectedIndexes=[],r._applySelection(!0,i)}clearSelection(){const e=this,t=e.selectedIndexes.slice(0);e.selectedIndexes=[],e._applySelection(!1,t)}collapseAll(e){const t=this,r=t.animation,l=!1===e&&t.hasAnimation;l&&(t.animation="none"),t._collapseAll(!0),l&&(t.animation=r)}ensureVisible(e){const t=this;if(e=t.getItem(e),void 0===e||e.hidden)return;let r=!1;1<e.level&&!t._isBranchExpanded(e)&&(super.expandItem(e.parentItem,void 0,!1),r=t.hasAnimation,r&&(t._ensureVisibleOnTransitionend=e)),r||t._ensureVisible(e)}expandAll(e){const t=this,r=t.animation,l=!1===e&&t.hasAnimation;let o=1,a=(t.enableShadowDOM?t.shadowRoot:t).querySelectorAll("smart-tree-items-group[level=\"1\"]");for(l&&(t.animation="none");0<a.length;){for(let e=0;e<a.length;e++){const r=a[e];r.expanded||t._menuItemsGroupSelectionHandler(r,{target:r,type:"expand"})}o++,a=(t.enableShadowDOM?t.shadowRoot:t).querySelectorAll("smart-tree-items-group[level=\""+o+"\"]")}l&&(t.animation=r)}expandItem(e,t){const r=this;if(e=r.getItem(e),!(void 0===e||!1==e instanceof Smart.TreeItemsGroup||r._isContainerOpened(e.container.level,e.container))){const l=!1===t&&r.hasAnimation,o=r.animation;l&&(r.animation="none"),r._discardKeyboardHover(),r._menuItemsGroupSelectionHandler(e,{target:e,type:"expand"},arguments[2]),l&&(r.animation=o)}}filter(e){const t=this;t.filterable&&(t._applyFilter(e),t.$.filterInput.value=e)}getState(){return JSON.parse(JSON.stringify(this._state))}insert(e,t){function r(e){const t=e[l.itemsMember]||[],o="smart-tree-items-group"===e.tagName||0<t.length?"smart-tree-items-group":"smart-tree-item",a=document.createElement(o);if(e.disabled&&(a.disabled=!0),e[l.displayMember]&&(a.label=e[l.displayMember]),e.separator&&(a.separator=!0),e[l.valueMember]&&(a.value=e[l.valueMember]),"smart-tree-items-group"==o){e.expanded&&(a.expanded=!0);for(let e=0;e<t.length;e++)a.appendChild(r(t[e]))}else e.shortcut&&(a.shortcut=e.shortcut);return a}const l=this;let o;if(e instanceof Smart.TreeItem||e instanceof Smart.TreeItemsGroup){if(l.contains(e))return;o=e}else if("object"==typeof e&&e.constructor===Object)o=r(e);else return;if(void 0===t)return void l.addTo(o);if("number"==typeof t)t=t.toString();else if(t instanceof Smart.TreeItem||t instanceof Smart.TreeItemsGroup){if(!l.contains(t))return;t=t.path}else if("string"!=typeof t)return;const a=t.split(".");let n,i;1===a.length?(i=l._menuItems[a[0]],i?l.addBefore(o,i):l.addTo(o)):(i=l._menuItems[t],n=l._menuItems[a.slice(0,a.length-1).join(".")],i?l.addBefore(o,i):n&&n instanceof Smart.TreeItemsGroup&&l.addTo(o,n))}loadState(e){const t=this,r=t.selectedIndexes.slice(0),l=[];if(!e){if(!t.id)return void t.warn(t.localize("noId"));e=window.localStorage.getItem("smartTree"+t.id)}"string"==typeof e&&(e=JSON.parse(e)),e.filter&&!t.filterable&&(e.filter="");let o=e.filter!==t._state.filter,a=e.sorted!==t.sorted;a?(t.sorted=e.sorted,t._updateState("sorted",t.sorted),e.sorted?t._applyGrouping(t.$.mainContainer):t._unsortItems(t.$.mainContainer),(e.filter||o)&&(t._applyFilter(e.filter),t.$.filterInput.value=e.filter)):o&&(t._applyFilter(e.filter),t.$.filterInput.value=e.filter),t._menuItemsGroupsToExpand=[];for(let r=0;r<e.expanded.length;r++){const l=t.getItem(e.expanded[r]);l&&t._menuItemsGroupsToExpand.push(l)}t._expandItemsByDefault(!0);for(let r=0;r<e.selected.length;r++){const o=t.getItem(e.selected[r]);o&&l.push(o.path)}t.selectedIndexes=l,t._applySelection(!1,r)}moveDown(e){const t=this;e=t.getItem(e);const r=e.nextElementSibling;void 0===e||!r||t.sorted||(t._moveTreeItem(e,r,2,[t]),t.filterable&&t._state.filter&&t._applyFilter(t._state.filter))}moveUp(e){const t=this;e=t.getItem(e);const r=e.previousElementSibling;void 0===e||!r||t.sorted||(t._moveTreeItem(e,r,0,[t]),t.filterable&&t._state.filter&&t._applyFilter(t._state.filter))}refresh(){this._checkOverflow()}removeItem(e){const t=this;if(e=t.getItem(e),void 0!==e){if(e instanceof Smart.TreeItemsGroup){const r=e.container;t._isContainerOpened(r.level,r)&&t._closeSubContainersTreeMode(r.level,r)}const r=t.sorted&&t.autoSort;r&&t._unsortItems(t.$.mainContainer),e.parentElement.removeChild(e),t._menuItems={},t._refreshItemPaths(t.$.mainContainer,!0,void 0,t.sorted&&!t.autoSort),r&&t._applyGrouping(t.$.mainContainer);const l=t._state.filter,o=t.selectedIndexes.slice(0);l&&t._applyFilter(l),t._checkOverflow(),t.selectedIndexes=[],t._applySelection(!0,o)}}saveState(){const e=this;return e.id?window.localStorage.setItem("smartTree"+e.id,JSON.stringify(e._state)):e.warn(e.localize("noId")),JSON.parse(JSON.stringify(e._state))}select(e){const t=this;e=t.getItem(e);void 0===e||e.selected||e.templateApplied||t._handleSelection(e,{type:"programmatic"})}unselect(e){const t=this;e=t.getItem(e);void 0===e||!e.selected||e.templateApplied||t._handleSelection(e,{type:"programmatic"})}updateItem(e,t){const r=this;if(e=r.getItem(e),void 0!==e&&void 0!==t){const r=e instanceof Smart.TreeItem;for(let l in t)if(t.hasOwnProperty(l)){if(r){if(-1===["disabled","label","level","selected","separator","shortcut","value"].indexOf(l))continue;}else if(-1===["disabled","expanded","label","level","selected","separator","value"].indexOf(l))continue;e[l]=t[l]}}}propertyChangedHandler(e,t,r){const l=this;switch(e){case"allowDrag":case"allowDrop":case"autoLoadState":case"autoSort":case"editable":case"filterInputPlaceholder":case"loadingIndicatorPlaceholder":case"selectionDisplayMode":case"showLines":case"showRootLines":case"toggleElementPosition":case"toggleMode":break;case"autoHideToggleElement":r?l.$mainContainer.addClass("hidden-arrows"):l.$mainContainer.removeClass("hidden-arrows");break;case"autoSaveState":if(!r)return;if(!l.id)return l.warn(l.localize("noId")),void(l.autoSaveState=!1);window.localStorage.setItem("smartTree"+l.id,JSON.stringify(l._state));break;case"dataSource":{const e=l.selectedIndexes.slice(0);l.selectedIndexes=[],l._menuItems={},l._processDataSource(),l._checkOverflow(),l._expandItemsByDefault(),l._applySelection(!0,e);const t=l._state.filter;t&&l._applyFilter(t);break}case"disabled":l._setFocusable(),l.$.scrollButtonNear.disabled=r,l.$.scrollButtonFar.disabled=r,r||l._updateScrollButtonVisibility();break;case"displayLoadingIndicator":r?(l._discardKeyboardHover(!0),l.$loadingIndicatorContainer.removeClass("smart-hidden")):l.$loadingIndicatorContainer.addClass("smart-hidden");break;case"filterable":!1===r&&(l._applyFilter(""),l.$.filterInput.value=""),l._checkOverflow();break;case"filterMode":l.filterable&&l._state.filter&&l._applyFilter(l._state.filter);break;case"hasThreeStates":if("checkBox"!==l.selectionMode)return;if(r)l._applySelection(!1);else{const e=(l.enableShadowDOM?l.shadowRoot:l).querySelectorAll("[indeterminate]");for(let t=0;t<e.length;t++)e[t].removeAttribute("indeterminate")}break;case"loadingIndicatorPosition":"center"===r?l.$loadingIndicatorPlaceHolder.addClass("smart-hidden"):l.$loadingIndicatorPlaceHolder.removeClass("smart-hidden");break;case"overflow":if("scrollbar"===l.scrollMode)return"hidden"===r?l.$.scrollViewer.$.verticalScrollBar.setAttribute("aria-hidden",!0):l.$.scrollViewer.$.verticalScrollBar.removeAttribute("aria-hidden"),void(l.$.scrollViewer.verticalScrollBarVisibility="scroll"===r?"visible":"auto");l.$.scrollViewer.scrollTop=0,"hidden"===r?(l.$scrollViewer.removeClass("scroll-buttons-shown"),l.$scrollButtonNear.addClass("smart-hidden"),l.$scrollButtonFar.addClass("smart-hidden")):(l.$.scrollButtonNear.disabled=l.disabled,l.$.scrollButtonFar.disabled=l.disabled,"auto"===r?(l.$scrollButtonNear.addClass("smart-hidden"),l.$scrollButtonFar.addClass("smart-hidden"),l._checkOverflow()):(l.$scrollViewer.addClass("scroll-buttons-shown"),l.$scrollViewer.removeClass("one-button-shown"),l.$scrollButtonNear.removeClass("smart-hidden"),l.$scrollButtonFar.removeClass("smart-hidden"),l._updateScrollButtonVisibility())),l.$.scrollViewer.refresh();break;case"rightToLeft":{let e,t;for(let o in r?(e="paddingLeft",t="paddingRight"):(e="paddingRight",t="paddingLeft"),l._menuItems)if(l._menuItems.hasOwnProperty(o)){const r=l._menuItems[o],a=r.firstElementChild;a.style[e]="",l._setIndentation(a,r.level,t)}break}case"scrollMode":if("hidden"===l.overflow)return;if(l.$.scrollViewer.scrollTop=0,"scrollButtons"===r)return"scroll"===l.overflow&&(l.$scrollViewer.addClass("scroll-buttons-shown"),l.$scrollButtonNear.removeClass("smart-hidden"),l.$scrollButtonFar.removeClass("smart-hidden")),l.$.scrollViewer.$.verticalScrollBar.setAttribute("aria-hidden",!0),l.$.scrollViewer.verticalScrollBarVisibility="auto",void l._checkOverflow();l.$.scrollViewer.$.verticalScrollBar.removeAttribute("aria-hidden"),l.$scrollViewer.removeClass("scroll-buttons-shown"),l.$scrollViewer.removeClass("one-button-shown"),l.$scrollButtonNear.addClass("smart-hidden"),l.$scrollButtonFar.addClass("smart-hidden"),l.$.scrollViewer.verticalScrollBarVisibility="auto"===l.overflow?"auto":"visible";break;case"selectedIndexes":l._applySelection(!1,t);break;case"selectionMode":if(l.setAttribute("aria-multiselectable",-1!==["oneOrManyExtended","zeroOrMany","oneOrMany","checkBox","radioButton"].indexOf(r)),void 0===l._menuItems[0])return;if("one"===t&&"none"!==r&&"checkBox"!==r&&"radioButton"!==r||-1!==t.indexOf("oneOrMany")&&-1!==r.indexOf("oneOrMany")||"none"===t&&(-1!==r.indexOf("zero")||"checkBox"===r)||"zeroOrMany"===r&&"checkBox"!==t||"radioButton"===t&&-1!==r.indexOf("Many")||!l.hasThreeStates&&("checkBox"===r||"checkBox"===t&&"zeroOrMany"===r))return l._lastSelectedItem="one"===r||"oneOrManyExtended"===r?l._menuItems[l.selectedIndexes[l.selectedIndexes.length-1]]:void 0,void l._applyAriaSelected();if(l.hasThreeStates&&"checkBox"===t){const e=(l.enableShadowDOM?l.shadowRoot:l).querySelectorAll("[indeterminate]");for(let t=0;t<e.length;t++)e[t].removeAttribute("indeterminate")}l._applySelection(!1);break;case"sort":{if(!l.sorted)return;l._refreshSorting();break}case"sortDirection":l.sorted&&!l.sort&&(l._unsortItems(l.$.mainContainer),l._applyGrouping(l.$.mainContainer));break;case"sorted":{if(!r&&!l.autoSort)return l._refreshItemPathsAndSelection(),void l._updateState("sorted",!1);r?l._applyGrouping(l.$.mainContainer):l._unsortItems(l.$.mainContainer);const e=l._state.filter;e&&l._applyFilter(e),l._updateState("sorted",r),l._checkOverflow();break}case"unfocusable":l._setFocusable();}}_addDragFeedback(){const e=this,t=document.createElement("div");return t.className="smart-tree-item-feedback",t.setAttribute("parent-tree-id",e.id),e.theme&&t.classList.add(e.theme),e.dragFeedbackFormatFunction?t.innerHTML=e.dragFeedbackFormatFunction(e._dragDetails.Items):1===e._dragDetails.Items.length?t.innerHTML=e._dragDetails.Item.label:(t.classList.add("multiple"),t.innerHTML="&#xf0c5;"),document.body.appendChild(t),t}_applyFilter(e){function t(e,t){e?(t.hidden&&t.$.removeClass("smart-hidden"),t.hidden=!1):(!t.hidden&&t.$.addClass("smart-hidden"),t.hidden=!0)}function r(o,a){let n,s=!1,d=0;a=Array.from(a);for(let c=0;c<a.length;c++){const o=a[c];o instanceof Smart.TreeItem?t(l._findItem(o,e),o):r(o,o.itemContainer.children),o.hidden||(d++,n=o),s=s||!o.hidden}if(o!==l.$.mainContainer){const r=l._findItem(o,e);t(s||r,o),s&&null===r?o.$.addClass("filtered-child"):o.$.removeClass("filtered-child"),!s&&0<a.length?(o.hiddenChildren=!0,o.$.addClass("hidden-children"),l.collapseItem(o,void 0,!1)):(o.hiddenChildren=!1,o.$.removeClass("hidden-children"))}""!==e&&0<d&&n.$.addClass("last-filtered-child")}const l=this;if(""!==e||l.hasAttribute("filter-applied")){const t=Array.from(l.$.mainContainer.getElementsByClassName("last-filtered-child"));for(let e=0;e<t.length;e++)t[e].$.removeClass("last-filtered-child");r(l.$.mainContainer,l.$.mainContainer.children),""===e?l.removeAttribute("filter-applied"):l.setAttribute("filter-applied",""),l._updateState("filter",e),l._checkOverflow()}}_applyHierarchicalSelection(e,t){const r=this,l=e!==r.$.mainContainer,o=l?e.itemContainer.children:e.children;let a=0,n=0;for(let s=0;s<o.length;s++){const i=o[s];e.selected&&i.set("selected",!0),i instanceof Smart.TreeItemsGroup?r._applyHierarchicalSelection(i,t):i.selected&&t.push(i.path),l&&(i.selected?a++:i.hasAttribute("indeterminate")&&n++)}l&&(r._setThreeStateCheckbox(e,a,n),e.selected&&t.push(e.path))}_applyRadioButtonSelection(e,t,r){const l=this,o=e===l.$.mainContainer?e.children:e.itemContainer.children,a=[];let n;for(let n=0;n<o.length;n++){const e=o[n];e instanceof Smart.TreeItemsGroup&&l._applyRadioButtonSelection(e,t,r),e.set("selected",!1),-1!==t.indexOf(e.path)&&a.push(e)}n=0===a.length?o[0]:a[a.length-1],n.set("selected",!0),r.push(n.path)}_applySelection(e,t){const r=this;let l=r.selectedIndexes.slice(0);if(void 0===t&&(t=l.slice(0)),void 0===r._menuItems[0])return r.selectedIndexes=[],r._lastSelectedItem=void 0,void(r.isRendered&&JSON.stringify(t)!==JSON.stringify([])&&r.$.fireEvent("change",{selectedIndexes:r.selectedIndexes,oldSelectedIndexes:t}));const o=r.selectionMode,a=Array.from((r.shadowRoot||r).querySelectorAll("smart-tree-item[selected], smart-tree-items-group[selected]"));for(let o=l.length-1;0<=o;o--){const e=r._menuItems[l[o]];void 0===e&&l.splice(o,1)}if(e)for(let e=0;e<a.length;e++)-1===l.indexOf(a[e].path)&&l.push(a[e].path);else{for(let e=0;e<a.length;e++)a[e].set("selected",!1);a.length=0}switch(r._sortPathCollection(l),o){case"none":l.length=0;for(let e=0;e<a.length;e++)a[e].set("selected",!1);break;case"one":case"zeroOrOne":"zeroOrOne"!==o&&0===l.length&&l.push("0");for(let e=0;e<l.length;e++){const t=r._menuItems[l[e]];if(e==l.length-1){t.set("selected",!0),l=[l[e]];break}-1!==a.indexOf(t)&&t.set("selected",!1)}break;case"oneOrMany":case"oneOrManyExtended":0===l.length&&l.push("0");for(let e=0;e<l.length;e++)r._menuItems[l[e]].set("selected",!0);break;case"zeroOrMany":case"checkBox":for(let e=0;e<l.length;e++)r._menuItems[l[e]].set("selected",!0);if("checkBox"===o&&r.hasThreeStates){const e=[];r._applyHierarchicalSelection(r.$.mainContainer,e),r._sortPathCollection(e),l=e}break;case"radioButton":{const e=[];r._applyRadioButtonSelection(r.$.mainContainer,l,e),r._sortPathCollection(e),l=e;break}}r.selectedIndexes=l,r._updateState("selected"),r._lastSelectedItem="one"===o||"oneOrManyExtended"===o?r._menuItems[l[l.length-1]]:void 0,r.isRendered&&!1!==arguments[2]&&JSON.stringify(t)!==JSON.stringify(l)&&r.$.fireEvent("change",{selectedIndexes:r.selectedIndexes,oldSelectedIndexes:t}),r._applyAriaSelected()}_applyAriaSelected(){const e=this,t=e.selectionMode;for(let r in e._menuItems){const l=e._menuItems[r];l.selected?l.setAttribute("aria-selected",!0):e._canItemBeSelected(l)&&-1!==["oneOrManyExtended","zeroOrMany","oneOrMany","checkBox","radioButton"].indexOf(t)?l.setAttribute("aria-selected",!1):l.removeAttribute("aria-selected")}}_autoLoadState(e){const t=this,r=[];for(let r=0;r<t._menuItemsGroupsToExpand.length;r++)t._menuItemsGroupsToExpand[r].set("expanded",!1);t._menuItemsGroupsToExpand=[];for(let r=0;r<e.expanded.length;r++){const l=t.getItem(e.expanded[r]);l&&t._menuItemsGroupsToExpand.push(l)}t.filterable&&e.filter&&(t._applyFilter(e.filter),t.$.filterInput.value=e.filter);for(let l=0;l<e.selected.length;l++){const o=t.getItem(e.selected[l]);o&&r.push(o.path)}t.selectedIndexes=r}_blurHandler(){this._discardKeyboardHover(!0)}_canItemBeHovered(e){const t=e.level;return!1===e.disabled&&!0!==e.templateApplied&&!0!==e.hidden&&(1===t||1<t&&this._isContainerOpened(t,e.parentElement.container)&&0<e.getBoundingClientRect().height)}_canItemBeSelected(e){return!1===e.disabled&&!0!==e.templateApplied}_checkOverflow(){var e=Math.round;const t=this,r=t.$.scrollViewer,l=t.overflow;if("scrollbar"===t.scrollMode||"hidden"===l)return void r.refresh();const o=r.scrollTop;"auto"===l&&(r.$.removeClass("scroll-buttons-shown"),r.$.removeClass("one-button-shown"),t.$scrollButtonNear.addClass("smart-hidden"),t.$scrollButtonFar.addClass("smart-hidden"));const a=e(r.$.scrollViewerContentContainer.offsetHeight)>e(r.$.scrollViewerContainer.offsetHeight),n=0<e(r.scrollTop),i=e(r.$.scrollViewerContainer.offsetHeight+r.scrollTop)<e(r.$.scrollViewerContentContainer.offsetHeight);a?"auto"===l?(r.$.addClass("scroll-buttons-shown"),n&&t.$scrollButtonNear.removeClass("smart-hidden"),i&&t.$scrollButtonFar.removeClass("smart-hidden"),!1==(n&&i)&&r.$.addClass("one-button-shown"),!t.disabled&&(t.$.scrollButtonNear.disabled=!1,t.$.scrollButtonFar.disabled=!1),r.scrollTop=o):(t.$scrollButtonNear.removeClass("smart-hidden"),t.$scrollButtonFar.removeClass("smart-hidden"),t.disabled?(t.$.scrollButtonNear.disabled=!0,t.$.scrollButtonFar.disabled=!0):(t.$.scrollButtonNear.disabled=!n,t.$.scrollButtonFar.disabled=!i)):"scroll"===l&&(t.$.scrollButtonNear.disabled=!0,t.$.scrollButtonFar.disabled=!0),r.refresh()}_createElement(){const e=this,t=window.getComputedStyle(e.$.scrollViewer);e.setAttribute("role","tree"),e.setAttribute("aria-multiselectable",-1!==["oneOrManyExtended","zeroOrMany","oneOrMany","checkBox","radioButton"].indexOf(e.selectionMode)),e.setAttribute("aria-orientation","vertical"),e.$.scrollViewer.onVerticalChange=e._verticalScrollbarHandler,Object.defineProperty(e,"dataSource",{get:function(){return e.context===e?e.properties.dataSource.value:e._getDataSource()},set(t){e.updateProperty(e,e._properties.dataSource,t)}}),!e.id&&(e.autoLoadState||e.autoSaveState)&&(e.warn(e.localize("noId")),e.autoLoadState=!1,e.autoSaveState=!1),e.mode="tree",e._element="tree",e._isMobile=Smart.Utilities.Core.isMobile,e._edgeMacFF=!1,e._autoScrollCoefficient=Smart.Utilities.Core.Browser.Firefox?4:Smart.Utilities.Core.Browser.Edge?8:2,e._scrollViewerPadding=parseFloat(t.paddingTop)+parseFloat(t.paddingBottom)||0,e._state={expanded:[],filter:"",selected:[]},e._dblclickObject={numberOfClicks:0},e.autoHideToggleElement&&e.$mainContainer.addClass("hidden-arrows"),e.disabled&&(e.$.scrollButtonNear.disabled=!0,e.$.scrollButtonFar.disabled=!0),"scrollbar"===e.scrollMode&&"scroll"===e.overflow&&(e.$.scrollViewer.verticalScrollBarVisibility="visible"),null===e.dataSource&&e.$.mainContainer.firstElementChild instanceof HTMLUListElement&&e._processUList();const r=(e.shadowRoot||e).querySelectorAll("smart-tree-item, smart-tree-items-group"),l=function(){let t;e.autoLoadState&&(t=window.localStorage.getItem("smartTree"+e.id),t&&(t=JSON.parse(t),e.sorted=t.sorted)),e._setFocusable(),e._menuItems={},null===e.dataSource?e._processHTML(e.$.mainContainer,1):e._processDataSource(),("scrollButtons"===e.scrollMode||"hidden"===e.overflow)&&e.$.scrollViewer.$.verticalScrollBar.setAttribute("aria-hidden",!0),"scrollButtons"===e.scrollMode&&"scroll"===e.overflow&&(e.$scrollViewer.addClass("scroll-buttons-shown"),e.$scrollButtonNear.removeClass("smart-hidden"),e.$scrollButtonFar.removeClass("smart-hidden"),e._updateScrollButtonVisibility()),e._checkOverflow(),t&&e._autoLoadState(t),e._expandItemsByDefault(),e._applySelection(!0),e._updateState("sorted",e.sorted),e.displayLoadingIndicator&&e.$loadingIndicatorContainer.removeClass("smart-hidden"),"center"!==e.loadingIndicatorPosition&&e.$loadingIndicatorPlaceHolder.removeClass("smart-hidden"),e.__onCompleted&&(e._onCompleted=e.__onCompleted,e.__onCompleted=null,e._onCompleted())};0===r.length||e.enableShadowDOM||e.isInShadowDOM?l():(e._onCompleted&&(e.__onCompleted=e._onCompleted,e._onCompleted=null),e._ensureItemsReady(r,l)),e.checkLicense()}_dblclickHandler(e,t,r){const l=this;"dblclick"!==l.toggleMode||e instanceof Smart.TreeItem||t||l._menuItemsGroupSelectionHandler(e,r)}_discardKeyboardHover(e,t){const r=this;t||!r._hoveredViaKeyboard||!e&&r._hoveredViaKeyboard instanceof Smart.MenuItemsGroup&&r._isContainerOpened(r._hoveredViaKeyboard.level+1,r._hoveredViaKeyboard.container)||(r._hoveredViaKeyboard.removeAttribute("focus"),r._hoveredViaKeyboard=void 0)}_documentUpHandler(e){const t=this,r=t._downTimeoutInfo;r&&(clearTimeout(r.timeout),t.$.scrollViewer.scrollTop===r.scrollTop&&t._continueSelection(r.target,r.event),delete t._downTimeoutInfo);const l=t._downItem,o=t.enableShadowDOM?e.originalEvent.composedPath()[0]:e.originalEvent.target;if(delete t._downItem,t._editedItem&&!t._editInputDown&&(!t._isMobile&&o!==t.$.editInput||t._isMobile&&document.elementFromPoint(e.clientX,e.clientY)!==t.$.editInput))return void t._endEditing();if(delete t._editInputDown,l){const r=o.closest("smart-tree-item")||o.closest("smart-tree-items-group");!r||!r.selected||r!==l||t._dragDetails&&t._dragDetails.FeedbackShown||r instanceof Smart.TreeItemsGroup&&(o.closest(".smart-tree-items-group-arrow")||o===r.container||o===r.container.firstElementChild)||t._handleSelection(r,e)}const a=t._dragDetails;if(!a)return;const n=Smart.Tree.hoveredTree,s=Smart.Tree.hoveredItem;if(delete t._dragDetails,delete Smart.Tree.treeItemDragged,delete Smart.Tree.hoveredTree,delete Smart.Tree.hoveredItem,t.$.scrollViewer._scrollView.disableSwipeScroll=!1,!a.FeedbackShown)return;const i=n||document.elementFromPoint(e.clientX,e.clientY);let d;document.body.classList.remove("smart-dragging"),document.body.removeChild(a.Feedback),n&&clearInterval(n._dragInterval);const c=a.Item,m=a.Items,u=a.ValidItems;if(!i)return;if(!s||c.contains(s))return void t.$.fireEvent("dragEnd",{item:c,items:m,target:i,data:a,previousContainer:t,container:n||i,originalEvent:e});if(!(n&&n.allowDrop&&!n.disabled))return;const p=[n];let h;if(s.classList.remove("drop-target"),s.classList.contains("top")?(s.classList.remove("top"),h="top",d=0):s.classList.contains("bottom")?(s.classList.remove("bottom"),h="bottom",d=2):(h="inside",d=1),a.DropDetails={item:s,position:h},n!==t)p.push(t);else if(a.ValidateOnDrop)for(let e=0;e<u.length;e++)if(u[e].contains(s))return;const _=t.$.fireEvent("dragEnd",{item:c,items:m,target:s,data:a,previousContainer:t,container:n,originalEvent:e});if(!_.defaultPrevented){n.sorted&&n.autoSort&&n._unsortItems(n.$.mainContainer);for(let e=0;e<u.length;e++)t._moveTreeItem(u[e],s,d,p);n.sorted&&n.autoSort&&n._applyGrouping(n.$.mainContainer),n!==t&&n._state.filter&&n._applyFilter(n._state.filter)}}_editInputBlurHandler(){this._endEditing()}_endEditing(e){const t=this,r=t._editedItem;if(r&&(delete t._editedItem,t.$editInput.addClass("smart-hidden"),t.focus(),!e)){const e=t.$.editInput.value,l=t.sorted&&t.autoSort,o=t._state.filter;e===r.label||(r.set("label",e),r.firstElementChild.firstElementChild.firstElementChild.innerHTML=e,l&&(t._unsortItems(t.$.mainContainer),t._applyGrouping(t.$.mainContainer)),o&&t._applyFilter(o))}}_ensureVisible(e){const t=this;t._ensureVisibleTreeMode(e,e.getBoundingClientRect(),t.$.scrollViewer,t.$.scrollViewer.getBoundingClientRect(),t._scrollViewerPadding),t._ensureVisibleCallback&&t._ensureVisibleCallback(e)}_filterInputKeydownHandler(e){if("PageDown"!==e.key)return void("PageUp"===e.key&&(e.preventDefault(),e.stopPropagation()));const t=this;let r;if(e.preventDefault(),e.stopPropagation(),0<t.selectedIndexes.length){const e=t.selectedIndexes.slice(0);r=t._lastSelectedItem||t._menuItems[t.selectedIndexes[t.selectedIndexes.length-1]],"checkBox"!==t.selectionMode&&"radioButton"!==t.selectionMode&&(t.selectedIndexes=[r.path],t._applySelection(!1,e)),t.focus()}else r=t._getFirstEnabledChild(t.$.mainContainer),t.focus(),r&&t._hoverViaKeyboard(r);t._ensureVisible(r)}_focusHandler(){const e=this;0<e.selectedIndexes.length&&!e._hoveredViaKeyboard&&(e._lastSelectedItem?e._hoverViaKeyboard(e._lastSelectedItem,!1,void 0,!1):e._hoverViaKeyboard(e._menuItems[e.selectedIndexes[e.selectedIndexes.length-1]],!1,void 0,!1))}_getDataSource(){function e(t,r){for(let l=0;l<t.length;l++){const o=t[l],a={label:o.label};o.disabled&&(a.disabled=!0),o.selected&&(a.selected=!0),o.separator&&(a.separator=!0),null!==o.value&&(a.value=o.value),o instanceof Smart.TreeItem?o.shortcut&&(a.shortcut=o.shortcut):(o.expanded&&(a.expanded=!0),a.items=[],e(o.itemContainer.children,a.items)),r.push(a)}}const t=this,r=[];return e(t.$.mainContainer.children,r),r}_handleHierarchicalSelection(e,t){function r(e,t){const l=e.itemContainer.children;for(let o=0;o<l.length;o++){const e=l[o];e.set("selected",t),e.setAttribute("aria-selected",t),e.removeAttribute("indeterminate"),e instanceof Smart.TreeItemsGroup&&r(e,t)}}const l=this;let o=e;for(e.selected?(e.set("selected",!1),e.setAttribute("aria-selected",!1)):(e.set("selected",!0),e.setAttribute("aria-selected",!0),e.removeAttribute("indeterminate"));o.parentItem;){const e=o.parentItem,t=e.itemContainer.children;let r=0,a=0;for(let e=0;e<t.length;e++)t[e].selected?r++:t[e].hasAttribute("indeterminate")&&a++;l._setThreeStateCheckbox(e,r,a),o=e}e instanceof Smart.TreeItemsGroup&&r(e,e.selected),t.length=0;const a=Array.from((l.enableShadowDOM?l.shadowRoot:l).querySelectorAll("[selected]"));for(let r=0;r<a.length;r++)t.push(a[r].path);l._sortPathCollection(t)}_handleSelection(e,t){const r=this,l=r.selectionMode;if("none"===l||"programmatic"!==t.type&&!r._canItemBeSelected(e))return;const o=e.selected;if(o&&"down"===t.type)return;const a=r.selectedIndexes.slice(0);let n=a.slice(0);switch(l){case"one":if(o)return;r._menuItems[n[0]].set("selected",!1),r._menuItems[n[0]].removeAttribute("aria-selected"),r.selectedIndexes=[e.path],e.set("selected",!0),e.setAttribute("aria-selected",!0),r._lastSelectedItem=e;break;case"zeroOrOne":o?(r.selectedIndexes=[],e.set("selected",!1),e.removeAttribute("aria-selected")):(void 0!==n[0]&&(r._menuItems[n[0]].set("selected",!1),r._menuItems[n[0]].removeAttribute("aria-selected")),r.selectedIndexes=[e.path],e.set("selected",!0),e.setAttribute("aria-selected",!0));break;case"oneOrMany":case"zeroOrMany":if(o){if(1===n.length&&"zeroOrMany"!==l)return;n.splice(n.indexOf(e.path),1),e.set("selected",!1),e.setAttribute("aria-selected",!1)}else n.push(e.path),r._sortPathCollection(n),e.set("selected",!0),e.setAttribute("aria-selected",!0);r.selectedIndexes=n;break;case"oneOrManyExtended":{const l=t.ctrlKey,o=t.shiftKey;if(!l&&!o||o&&e===r._lastSelectedItem){for(let e=0;e<n.length;e++)r._menuItems[n[e]].set("selected",!1),r._menuItems[n[e]].setAttribute("aria-selected",!1);n=[e.path],e.set("selected",!0),e.setAttribute("aria-selected",!0),r._lastSelectedItem=e}else if(l)e.selected&&1<n.length?(n.splice(n.indexOf(e.path),1),e.set("selected",!1),e.setAttribute("aria-selected",!1)):!e.selected&&(n.push(e.path),r._sortPathCollection(n),e.set("selected",!0),e.setAttribute("aria-selected",!0),r._lastSelectedItem=e);else if(o){for(let e=0;e<n.length;e++)r._menuItems[n[e]].set("selected",!1),r._menuItems[n[e]].setAttribute("aria-selected",!1);n=r._selectItemRange(r._lastSelectedItem,e)}r.selectedIndexes=n;break}case"checkBox":r.hasThreeStates?r._handleHierarchicalSelection(e,n):o?(n.splice(n.indexOf(e.path),1),e.set("selected",!1),e.setAttribute("aria-selected",!1)):(n.push(e.path),r._sortPathCollection(n),e.set("selected",!0),e.setAttribute("aria-selected",!0)),r.selectedIndexes=n;break;case"radioButton":{if(e.selected)return;let t;for(let r=0;r<e.parentElement.children.length;r++){const l=e.parentElement.children[r];if(l.selected){t=l;break}}const l=n.indexOf(t.path);t.set("selected",!1),e.setAttribute("aria-selected",!1),e.set("selected",!0),e.setAttribute("aria-selected",!0),n.splice(l,1),n.push(e.path),r._sortPathCollection(n),r.selectedIndexes=n;break}}if(r._discardKeyboardHover(!0),r._hoverViaKeyboard(e,!1,void 0,!r._treeAnimationInProgress),r._updateState("selected"),JSON.stringify(a)!==JSON.stringify(r.selectedIndexes)){if(r.ownerElement&&!r.ownerElement.isRendered)return;r.$.fireEvent("change",{item:e,selectedIndexes:r.selectedIndexes,oldSelectedIndexes:a})}}_hoverViaKeyboard(e,t,r,l){if(e){const o=this;e.setAttribute("focus",""),o._hoveredViaKeyboard=e,!1!==l&&o._ensureVisible(e),t&&o._handleSelection(e,r),o._hoverViaKeyboardCallback&&o._hoverViaKeyboardCallback(e)}}_keydownHandler(e){function t(t){for(let r=t;r<n.length;r++){const t=n[r];if(o._canItemBeHovered(t)){if(s){if(s===t)break;s.removeAttribute("focus")}o._hoverViaKeyboard(t,i,e);break}}}function r(t){for(let r=t;0<=r;r--){const t=n[r];if(o._canItemBeHovered(t)){if(s){if(s===t)break;s.removeAttribute("focus")}o._hoverViaKeyboard(t,i,e);break}}}function l(){1<s.level&&o._canItemBeSelected(s.parentItem)&&(s.removeAttribute("focus"),o._hoverViaKeyboard(s.parentItem,i,e))}const o=this,a=e.key;if(o._editedItem)return void("Enter"===a?o._endEditing():"Escape"===a&&o._endEditing(!0));if(o.getRootNode().activeElement!==o||-1===["ArrowDown","ArrowLeft","ArrowRight","ArrowUp","End","Enter","F2","Home","PageDown","PageUp"," "].indexOf(a)||o.disabled||o.displayLoadingIndicator)return;e.preventDefault();const n=Array.from(o.$.mainContainer.querySelectorAll("smart-tree-item, smart-tree-items-group")),i="one"===o.selectionMode||"oneOrManyExtended"===o.selectionMode&&!e.ctrlKey,s=o.$.mainContainer.querySelector("[focus]");let d;switch(a){case"ArrowDown":d=s?n.indexOf(s)+1:0,t(d);break;case"ArrowLeft":if(!s)return;if(s instanceof Smart.TreeItem)l();else{if(o._isContainerOpened(s.level+1,s.container))return void o._closeSubContainersTreeMode(s.level+1,s.container,!0,!0);l()}break;case"ArrowRight":if(!s||s instanceof Smart.TreeItem)return;if(o._isContainerOpened(s.level+1,s.container)){const t=o._getFirstEnabledChild(s.itemContainer);t&&(s.removeAttribute("focus"),o._hoverViaKeyboard(t,i,e))}else o._menuItemsGroupSelectionHandler(s,{target:s,type:"keydown"});break;case"ArrowUp":d=s?n.indexOf(s)-1:n.length-1,r(d);break;case"End":r(n.length-1);break;case"Enter":s&&s instanceof Smart.TreeItemsGroup&&o._menuItemsGroupSelectionHandler(s,{target:s,type:"keydown"});break;case"F2":o.editable&&o._startEditing(s);break;case"Home":t(0);break;case"PageDown":o._pageDownHandler(n,s,i,e);break;case"PageUp":o._pageUpHandler(n,s,i,e);break;case" ":s&&o._handleSelection(s,e);}}_mainContainerSwipeHandler(e){Smart.Tree.treeItemDragged&&e.stopPropagation()}_menuItemsGroupSelectionHandler(e,t,r){const l=this,o=l.toggleMode,a=!!t.originalEvent&&t.originalEvent.target.classList.contains("smart-tree-items-group-arrow"),n=e.container;if(!(l._waitAnimation&&l._treeAnimationInProgress===n)&&("down"!==t.type||a||"dblclick"===o&&1!==l._dblclickObject.numberOfClicks||l._handleSelection(e,t),!("down"===t.type&&!a&&("dblclick"===o&&2!==l._dblclickObject.numberOfClicks||"click"===o&&1<l._dblclickObject.numberOfClicks||"arrow"===o)||e.hiddenChildren))){const o=n.level;let a=l.hasAnimation;if("keydown"===t.type&&l._discardKeyboardHover(),l._treeAnimationInProgress&&(n.removeEventListener("transitionend",l._transitionendHandlerExpand),n.removeEventListener("transitionend",l._transitionendHandlerCollapse)),l._isContainerOpened(o,n))l._closeSubContainersTreeMode(o,n,!0,!1!==r);else{const i=l.$.fireEvent("expanding",{item:e,label:e.label,path:e.path,value:e.value,children:e.itemContainer.children});if(i.defaultPrevented)return;if(a&&("expand"!==t.type&&(l._ensureVisibleOnTransitionend=e),l._expandSection(n)),n.$.removeClass("smart-visibility-hidden"),"keydown"===t.type&&(e.setAttribute("focus",""),l._hoveredViaKeyboard=e),e.$.addClass("smart-tree-items-group-opened"),e.$.addClass("smart-tree-items-group-expanded"),l._addOpenedContainer(o,n),void 0===t.type&&l._hoverViaKeyboard(l._getFirstEnabledChild(e.itemContainer)),!1!==r){const t={item:e,label:e.label,path:e.path,value:e.value,children:e.itemContainer.children};l.toggleCallback?(t.type="expand",l.toggleCallback(t)):l.$.fireEvent("expand",t)}}a||(l._checkOverflow(),"expand"!==t.type&&l._ensureVisible(e))}}_mouseenterHandler(){const e=this;e.autoHideToggleElement&&e.$mainContainer.removeClass("hidden-arrows"),Smart.Tree.treeItemDragged&&e.allowDrop&&!e.disabled&&(Smart.Tree.hoveredTree=e)}_mouseleaveHandler(){const e=this;if(e.autoHideToggleElement&&e.$mainContainer.addClass("hidden-arrows"),Smart.Tree.treeItemDragged){Smart.Tree.hoveredTree&&(clearInterval(Smart.Tree.hoveredTree._dragInterval),delete Smart.Tree.hoveredTree);const e=Smart.Tree.hoveredItem;e&&(e.classList.remove("drop-target"),e.classList.remove("top"),e.classList.remove("bottom"),delete Smart.Tree.hoveredItem)}}_moveHandler(e){var t=Math.abs;const r=this,l=r._dragDetails;if(!l)return;if(!l.FeedbackShown)if(5<t(l.StartPosition.left-e.pageX)||5<t(l.StartPosition.top-e.pageY)){const e=r.$.fireEvent("dragStart",{item:l.Item,items:l.Items,data:l,container:r,previousContainer:r,originalEvent:l.OriginalEvent});if(e.defaultPrevented)return delete r._dragDetails,delete Smart.Tree.treeItemDragged,delete Smart.Tree.hoveredTree,delete Smart.Tree.hoveredItem,void(r.$.scrollViewer._scrollView.disableSwipeScroll=!1);document.body.classList.add("smart-dragging"),l.Feedback=r._addDragFeedback(),l.FeedbackShown=!0}else return;const o=r.dragOffset;let a,n,i;if(r.$.fireEvent("dragging",{item:l.Item,items:l.Items,data:l,originalEvent:e}),l.Feedback.style.left=e.pageX+o[0]+"px",l.Feedback.style.top=e.pageY+o[1]+"px",r._isMobile){const t=Smart.Tree.hoveredItem;t&&(t.classList.remove("drop-target"),t.classList.remove("top"),t.classList.remove("bottom"),delete Smart.Tree.hoveredItem);const r=document.elementFromPoint(e.clientX,e.clientY);Smart.Tree.hoveredTree&&(clearInterval(Smart.Tree.hoveredTree._dragInterval),delete Smart.Tree.hoveredTree),r&&(a=r.closest("smart-tree"),a&&a.allowDrop&&(Smart.Tree.hoveredTree=a,n=r.closest("smart-tree-item")||r.closest("smart-tree-items-group"),n?i=n:n=r))}if(a=Smart.Tree.hoveredTree,!a)return;const s=a.filterable?a.$.filterInput.offsetHeight+10:0;if(clearInterval(a._dragInterval),a._dragInterval=setInterval(function(){const t=a.getBoundingClientRect();0<a.$.scrollViewer.scrollHeight&&t.left<=e.clientX&&t.left+t.width>=e.clientX?e.clientY>=t.top+s&&e.clientY<=t.top+20+s?(a.$.scrollViewer.scrollTop-=r._autoScrollCoefficient,"scrollButtons"===a.scrollMode&&a._updateScrollButtonVisibility()):e.clientY>=t.top+t.height-20&&e.clientY<=t.top+t.height?(a.$.scrollViewer.scrollTop+=r._autoScrollCoefficient,"scrollButtons"===a.scrollMode&&a._updateScrollButtonVisibility()):clearInterval(a._dragInterval):clearInterval(a._dragInterval)},1),r._isMobile||(n=e.originalEvent.target,n&&n.enableShadowDOM&&(n=e.originalEvent.composedPath()[0]),n&&n.closest&&(i=n.closest("smart-tree-item")||n.closest("smart-tree-items-group"))),i){if(Smart.Tree.hoveredItem&&i!==Smart.Tree.hoveredItem&&(Smart.Tree.hoveredItem.classList.remove("drop-target"),Smart.Tree.hoveredItem.classList.remove("top"),Smart.Tree.hoveredItem.classList.remove("bottom")),Smart.Tree.hoveredItem=i,l.Item.contains(i))return;const t=i.getBoundingClientRect();i instanceof Smart.TreeItem?e.clientY-t.top<=t.height/2?(i.classList.remove("bottom"),i.classList.add("top")):(i.classList.remove("top"),i.classList.add("bottom")):10>=e.clientY-t.top?(i.classList.remove("bottom"),i.classList.add("top")):!i.expanded&&10>=t.bottom-e.clientY?(i.classList.remove("top"),i.classList.add("bottom")):(i.classList.remove("top"),i.classList.remove("bottom")),i.classList.add("drop-target")}else if(Smart.Tree.hoveredItem&&(Smart.Tree.hoveredItem.classList.remove("drop-target"),Smart.Tree.hoveredItem.classList.remove("top"),Smart.Tree.hoveredItem.classList.remove("bottom")),n!==a.$.scrollViewer.$.scrollViewerContainer)delete Smart.Tree.hoveredItem;else if(a._menuItems[0]){let e=a.$.mainContainer.lastElementChild,t=a.$.mainContainer.childElementCount-1;for(;e.hidden&&(t--,e=a.$.mainContainer.children[t],!!e););e?(Smart.Tree.hoveredItem=e,Smart.Tree.hoveredItem.classList.add("bottom")):Smart.Tree.hoveredItem=a.$.container,Smart.Tree.hoveredItem.classList.add("drop-target")}else Smart.Tree.hoveredItem=a.$.container,Smart.Tree.hoveredItem.classList.add("drop-target")}_moveSubItems(e,t,r){const l=this;for(let o=0;o<e.length;o++){const a=e[o];a.menu=t,a.set("level",a.parentItem.level+1),a.firstElementChild.style.paddingLeft="",a.firstElementChild.style.paddingRight="",l._setIndentation(a.firstElementChild,a.level,r),a.hidden=!1,a.$.removeClass("smart-hidden"),a.$.removeClass("filtered-child"),a.$.removeClass("last-filtered-child"),a instanceof Smart.TreeItemsGroup&&(a.$.removeClass("hidden-children"),a.container.level=a.level+1,l._moveSubItems(a.itemContainer.children,t,r),t!==l&&a.expanded&&(t._menuItemsGroupsToExpand.push(a),l._updateState("expanded",a.id,!1)))}}_moveTreeItem(e,t,r,l){const o=this,a=e.level;if(0===r){if(t.previousElementSibling===e)return;t.parentElement.insertBefore(e,t),e.set("level",t.level)}else if(2===r){if(t.nextElementSibling===e)return;t.parentElement.insertBefore(e,t.nextElementSibling||null),e.set("level",t.level)}else if(t===l[0].$.container)l[0].$.mainContainer.appendChild(e),e.set("level",1);else{if(t.itemContainer.lastElementChild===e)return;t.itemContainer.appendChild(e),e.set("level",t.level+1)}const n=l[0].rightToLeft?"paddingRight":"paddingLeft";if(e.menu=l[0],e.parentItem=e.parentElement.menuItemsGroup,e.firstElementChild.style.paddingLeft="",e.firstElementChild.style.paddingRight="",o._setIndentation(e.firstElementChild,e.level,n),e.hidden=!1,e.$.removeClass("smart-hidden"),e.$.removeClass("filtered-child"),e.$.removeClass("last-filtered-child"),e instanceof Smart.TreeItemsGroup&&(e.$.removeClass("hidden-children"),e.container.level=e.level+1,o._moveSubItems(e.itemContainer.children,l[0],n),e.expanded)){const t=o._openedContainers[a+1].indexOf(e.container);-1!==t&&o._openedContainers[a+1].splice(t,1),l[0]._menuItemsGroupsToExpand.push(e),2===l.length&&o._updateState("expanded",e.id,!1)}for(let o=0;o<l.length;o++){const e=l[o],t=e.context,r=e.selectedIndexes.slice(0);e.context=e,e._menuItems={},e._refreshItemPaths(e.$.mainContainer,!0,void 0,e.sorted&&!e.autoSort),e.selectedIndexes=[],e._applySelection(!0,r,!1),e._checkOverflow(),e.context=t}l[0]._expandItemsByDefault()}_overriddenMenuHandler(){}_pageDownHandler(e,t,r,l){function o(){for(let t=e.length-1;0<=t;t--){const r=e[t];if(a._canItemBeHovered(r)&&a._getOffsetTop(r)+r.firstElementChild.offsetHeight<=n.scrollTop+n.$.container.offsetHeight)return r}}const a=this,n=a.$.scrollViewer;if(!t)return;let i=o();i&&(t===i?n.scrollTop+n.$.container.offsetHeight!==n.$.scrollViewerContentContainer.offsetHeight&&(a.$.scrollViewer.scrollTop+=n.$.container.offsetHeight,"scrollButtons"===a.scrollMode&&a._updateScrollButtonVisibility(),i=o(),t.removeAttribute("focus"),a._hoverViaKeyboard(i,r,l)):(t.removeAttribute("focus"),a._hoverViaKeyboard(i,r,l)))}_pageUpHandler(e,t,r,l){function o(){for(let t=0;t<e.length;t++){const r=e[t];if(a._canItemBeHovered(r)&&a._getOffsetTop(r)>=n.scrollTop)return r}}const a=this,n=a.$.scrollViewer;if(!t)return;let i=o();i&&(t===i?0===n.scrollTop?a.filterable&&a.$.filterInput.focus():(a.$.scrollViewer.scrollTop-=n.$.container.offsetHeight,"scrollButtons"===a.scrollMode&&a._updateScrollButtonVisibility(),i=o(),t.removeAttribute("focus"),a._hoverViaKeyboard(i,r,l)):(t.removeAttribute("focus"),a._hoverViaKeyboard(i,r,l)))}_refreshItemPathsAndSelection(){const e=this,t=e.selectedIndexes.slice(0);e._menuItems={},e._refreshItemPaths(e.$.mainContainer,!0),e.selectedIndexes=[],e._applySelection(!0,t)}_refreshSorting(){const e=this;e._unsortItems(e.$.mainContainer),e._applyGrouping(e.$.mainContainer);const t=e._state.filter;t&&e._applyFilter(t),e._checkOverflow()}_scroll(e){const t=this;t.$.scrollViewer.scrollTop+=10*e,t._updateScrollButtonVisibility(),t.focus()}_scrollButtonFarClickHandler(){const e=this;e.$.scrollButtonFar.disabled||e._scroll(1)}_scrollButtonNearClickHandler(){const e=this;e.$.scrollButtonNear.disabled||e._scroll(-1)}_scrollViewerDownHandler(e){const t=this;if(e.target!==t.$.scrollViewer||t.disabled||t.displayLoadingIndicator||!t._isMobile&&1!==e.which)return;const r=e.originalEvent.target;if(r===t.$.editInput)return void(t._editInputDown=!0);if(t._isMobile){const l=t.$.scrollViewer.scrollTop,o=setTimeout(function(){if(t.$.scrollViewer.scrollTop!==l)return;else{const l=t.context;t.context=t,t._continueSelection(r,e),t.context=l}},250);t._downTimeoutInfo={target:r,event:e,scrollTop:l,timeout:o}}else t._continueSelection(r,e)}_continueSelection(e,t){const r=this,l=e.closest("smart-tree-item")||e.closest("smart-tree-items-group");if(!(l&&l.parentElement&&r._canItemBeSelected(l)))return;const o=e.closest(".smart-tree-items-group-arrow");let a;if(l instanceof Smart.TreeItem)a="_handleSelection";else{if(e===l.container||e===l.container.firstElementChild)return;a="_menuItemsGroupSelectionHandler"}if(clearTimeout(r._dblclickTimeout),l!==r._dblclickObject.target&&(r._dblclickObject.numberOfClicks=0),r._dblclickObject.target=l,r._dblclickObject.numberOfClicks++,r._dblclickTimeout=setTimeout(function(){r._dblclickObject.numberOfClicks=0},300),2===r._dblclickObject.numberOfClicks)if(!r.editable)r._dblclickHandler(l,o,t),r._dblclickObject.numberOfClicks=0;else return void r._startEditing(l);l.selected&&(r._downItem=l),r[a](l,t),r._discardKeyboardHover(!0),r._hoverViaKeyboard(l,!1,void 0,!1),o||r._startDragging(l,t)}_scrollViewerWheelHandler(){const e=this;"scrollButtons"===e.scrollMode&&"hidden"!==e.overflow&&e._updateScrollButtonVisibility()}_selectItemRange(e,t){const r=this,l=Array.from(r.$.mainContainer.querySelectorAll("smart-tree-item, smart-tree-items-group")),o=l.indexOf(e),a=l.indexOf(t),n=[];for(let s=Math.min(o,a);s<=Math.max(o,a);s++){const e=l[s];r._canItemBeHovered(e)&&(n.push(e.path),e.set("selected",!0))}return n}_setFocusable(){super._setFocusable();const e=this;return e.disabled||e.unfocusable?void(e.$.filterInput.tabIndex=-1):void e.$.filterInput.removeAttribute("tabindex")}_setIndentation(e,t,r){e.style[r]=20*t-10+"px"}_setThreeStateCheckbox(e,t,r){t===e.itemContainer.childElementCount?(e.removeAttribute("indeterminate"),e.set("selected",!0),e.setAttribute("aria-selected",!0)):0===t&&0===r?(e.removeAttribute("indeterminate"),e.set("selected",!1),e.setAttribute("aria-selected",!1)):(e.setAttribute("indeterminate",""),e.set("selected",!1),e.setAttribute("aria-selected",!1))}_sortItems(e){const t=this;if(!t.sorted)return;let r;e instanceof Smart.TreeItemsGroup?r=e.container.firstElementChild:e===t.$.mainContainer&&(r=e);let l=Array.from(r.children);if(t.sort){const r=t.sort(l,e);Array.isArray(r)&&(l=r)}else"asc"===t.sortDirection?l.sort(function(e,t){return e.label.localeCompare(t.label)}):l.sort(function(e,t){return t.label.localeCompare(e.label)});for(let t=l.length-1;0<=t;t--)r.insertBefore(l[t],r.firstElementChild)}_sortPathCollection(e){e.sort(function(e,t){const r=e.split("."),l=t.split("."),o=Math.max(r.length,l.length);for(let a=0;a<o;a++){const e=parseFloat(r[a]),t=parseFloat(l[a]);if(isNaN(e))return-1;if(isNaN(t))return 1;if(e<t)return-1;if(e>t)return 1}})}_startDragging(e,t){const r=this,l=r.selectionMode;if(!r.allowDrag||r._editedItem||"none"===l)return;const o=[],a=[];let n;if(-1!==["one","zeroOrOne","checkBox","radioButton"].indexOf(l))n=!1,o.push(e),a.push(e);else{n=!0;for(let e=0;e<r.selectedIndexes.length;e++)o.push(r._menuItems[r.selectedIndexes[e]]),a.push(o[e]);for(let e=0;e<o.length;e++){const t=o[e];if(-1!==a.indexOf(t))for(let e=a.length-1;0<=e;e--){const r=a[e];if(r===t)break;t.contains(r)&&a.splice(e,1)}}}r._dragDetails={StartPosition:{left:t.pageX,top:t.pageY},Items:o,ValidItems:a,Item:e,FeedbackShown:!1,ValidateOnDrop:n,OriginalEvent:t,StartTime:new Date,Dragging:!0},Smart.Tree.treeItemDragged=!0,r.$.scrollViewer._scrollView.disableSwipeScroll=!0,r.allowDrop&&(Smart.Tree.hoveredTree=r,Smart.Tree.hoveredItem=e)}_startEditing(e){const t=this,r=t.$.editInput;let l,o;if(!t._canItemBeSelected(e))return;const a=e.firstElementChild,n=a.firstElementChild;t.rightToLeft?(l=function(){return a.offsetWidth-n.offsetLeft-n.offsetWidth},o="paddingRight"):(l=function(){return n.offsetLeft+parseFloat(window.getComputedStyle(a).borderLeftWidth)},o="paddingLeft"),e instanceof Smart.TreeItemsGroup?(r.style[o]=l()+(t.showLines?parseFloat(window.getComputedStyle(n.firstElementChild).paddingLeft):0)-1+"px",r.style.height=a.offsetHeight+"px"):(r.style[o]=e.offsetWidth+parseInt(a.style[o],10)-a.offsetWidth+parseFloat(window.getComputedStyle(n.firstElementChild).paddingLeft)-2+"px",r.style.height=e.offsetHeight+"px"),r.style.top=t._getOffsetTop(e)+"px",t.$editInput.removeClass("smart-hidden"),r.value=e.label,t._editedItem=e,setTimeout(function(){r.focus()},0)}_styleChangedHandler(e){e.detail.styleProperties&&e.detail.styleProperties["font-size"]&&this._checkOverflow()}_updateScrollButtonVisibility(){var e=Math.round;const t=this,r=t.overflow;if("scrollbar"===t.scrollMode||"hidden"===r)return;let l=!0,o=!0;if(0===e(t.$.scrollViewer.scrollTop)&&(l=!1),e(t.$.scrollViewer.$.scrollViewerContainer.offsetHeight+t.$.scrollViewer.scrollTop)>=e(t.$.scrollViewer.$.scrollViewerContentContainer.offsetHeight)&&(o=!1),"auto"===r){if(l&&o)return t.$scrollButtonNear.removeClass("smart-hidden"),t.$scrollButtonFar.removeClass("smart-hidden"),t.$scrollViewer.removeClass("one-button-shown"),void t.$.scrollViewer.refresh();l?t.$scrollButtonNear.removeClass("smart-hidden"):t.$scrollButtonNear.addClass("smart-hidden"),o?t.$scrollButtonFar.removeClass("smart-hidden"):t.$scrollButtonFar.addClass("smart-hidden"),t.$scrollViewer.addClass("one-button-shown"),t.$.scrollViewer.refresh()}else"scroll"!==r||t.disabled||(t.$.scrollButtonNear.disabled=!l,t.$.scrollButtonFar.disabled=!o)}_updateState(e,t,r){const l=this;switch(e){case"expanded":{const e=l._state.expanded.indexOf(t);if(r&&-1===e)l._state.expanded.push(t);else if(!r&&-1!==e)l._state.expanded.splice(e,1);else return;break}case"filter":l._state.filter=t===void 0?l.$.filterInput.value:t;break;case"selected":l._state.selected=[];for(let e=0;e<l.selectedIndexes.length;e++){const t=l._menuItems[l.selectedIndexes[e]];l._state.selected.push(t.id)}break;case"sorted":l._state.sorted=t;}l.autoSaveState&&window.localStorage.setItem("smartTree"+l.id,JSON.stringify(l._state))}_verticalScrollbarHandler(){const e=this,t=e.$.verticalScrollBar,r=t.value;return e.disabled?void 0:t.max===r?void(e._bottomReached||(e.$.fireEvent("scrollBottomReached"),delete e._topReached,e._bottomReached=!0)):t.min===r?void(e._topReached||(e.$.fireEvent("scrollTopReached"),delete e._bottomReached,e._topReached=!0)):void(delete e._topReached,delete e._bottomReached)}});