
/* Smart HTML Elements v6.0.0 (2020-Jan) 
Copyright (c) 2011-2020 jQWidgets. 
License: https://htmlelements.com/license/ */

Smart.Utilities.Assign("Grid.Export",class{exportData(a,b){const c=this,d=new Smart.Utilities.DataExporter({exportHeader:c.dataExport.header}),e=[];if(d.expandChar=c.dataExport.expandChar,d.collapseChar=c.dataExport.collapseChar,d.pageOrientation=c.dataExport.pageOrientation,d.style=c.dataExport.style,d.filterBy=c.dataExport.filterBy,d.groupBy=c.dataExport.groupBy,d.header={columns:c.columns.toArray().slice(0),columngroups:c.columnGroups.slice(0)},!c.dataExport.style){const b=window.getComputedStyle(c),f=window.getComputedStyle(0<c.columns.length&&c.columns[0].element?c.columns[0].element:c.$.columnHeader),g=window.getComputedStyle(c.$.columnHeader),h=0===c.offsetWidth||0===c.offsetHeight;if(!h){const h=a=>{function b(a){return a=a.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/),a?"#"+c(a[1])+c(a[2])+c(a[3]).toUpperCase():"#ffffff"}function c(a){return isNaN(a)?"00":h[(a-a%16)/16]+h[a%16]}const d=a.fontSize,e=a.borderRightColor,f=a.backgroundColor,g=a.color,h=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];return{borderColor:b(e),fontSize:d,fontFamily:"Helvetica",color:b(g),backgroundColor:b(f)}},i=h(b),j=h(f),k=h(g),l={height:c.$.columnHeader.offsetHeight+"px",border:"1px solid "+i.borderColor,fontFamily:k.fontFamily,fontSize:k.fontSize,color:k.color,backgroundColor:j.backgroundColor,fontWeight:"400"},m={border:"1px solid "+i.borderColor,fontFamily:i.fontFamily,fontSize:i.fontSize},n={height:c.rowMinHeight+"px"};for(let b=0;b<c.columns.length;b++){const d=c.columns[b];if(!d.allowExport)continue;if(!d.visible)continue;l[d.dataField]={textAlign:d.align,width:d.computedWidth+"px",format:d.cellsFormat||""};let f=d.cellsFormat||"";"date"===d.dataType?f="d":"dateTime"===d.dataType?f="D":"time"===d.dataType&&(f="t");const g={textAlign:d.cellsAlign,format:f};if(m[d.dataField]=g,c.dataExport.view&&-1!==["html","jpeg","pdf","png"].indexOf(a)&&(d.template||d.formatFunction))for(let a=0;a<c.rows.length;a++){const b=c.rows[a];let f=c.rows[a]["column_"+d.dataField];if(c.dataExport.viewStart&&a<c.dataExport.viewStart||c.dataExport.viewEnd&&a>c.dataExport.viewEnd)continue;if(!f||b&&b.element&&b.element.classList.contains("smart-hidden")){const a=c._rowElements[0];if(!a)continue;if(b.element=a,b.grid=c,b.render(),f=b["column_"+d.dataField],!f)continue}const h={border:f.borderColor,background:f.background,color:f.color},i=void 0===c.dataExport.viewStart?a:a-c.dataExport.viewStart;e[a]=Object.assign({},b.data),e[a][d.dataField]=f.element.textContent,g[i]=h}}0<c.appearance.alternationCount&&(n.alternationCount=c.appearance.alternationCount,n.alternationStart=c.appearance.alternationStart,n.alternationEnd=c.appearance.alternationEnd,n.alternationIndex0Color=i.color,n.alternationIndex0BackgroundColor=i.backgroundColor,n.alternationIndex1Color=i.color,n.alternationIndex1BackgroundColor="#F5F5F5"),d.style={border:"1px solid "+i.borderColor,borderCollapse:"collapse",header:l,columns:m,rows:n}}}const f=!c.rowHierarchy||c.grouping.enabled?c.rows.toArray():c.rowHierarchy;let g=[];if(c.dataExport.view)c._recyclingRows.forEach((a,b)=>!!(c.dataExport.viewStart&&b<c.dataExport.viewStart||c.dataExport.viewEnd&&b>c.dataExport.viewEnd)||void(e[b]?g.push(e[b]):g.push(a.data)));else{for(let a=0;a<f.length;a++){const b=f[a];b.visible&&(!1!==b.filtered||void 0===b.filtered)&&g.push(b.data)}f===c.rowHierarchy&&(g=c.dataSource.boundHierarchy,d.hierarchical=!0)}!c.dataExport.groupBy&&c.grouping.enabled&&c.dataSource&&c.dataSource.groupBy&&(d.groupBy=c.dataSource.groupBy&&c.dataSource.groupBy.toArray?c.dataSource.groupBy.toArray():null),c.checkLicense(!0);const h=d.exportData(g,a,c.dataExport.fileName,b);return c.dataExport.view&&c._recycle(!1),h}print(){const a=this,b=a.dataExport.fileName;a.dataExport.fileName=null;const c=a.exportData("html"),d=window.open("","","width=800,height=500"),e=d.document.open();try{e.write("<!DOCTYPE html><html><head><meta charset=\"utf-8\" /><title>"+b+"</title></head><body>"+c+"</body></html>"),e.close(),setTimeout(function(){d.print(),d.close()},100)}catch(a){}a.dataExport.fileName=b}});